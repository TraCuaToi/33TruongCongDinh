function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Orders");
  if (!sheet) {
    sheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet("Orders");
    sheet.appendRow(["SÄT","TÃªn mÃ³n","Size","SL","Topping","Ghi chÃº","Tá»•ng tiá»n","Thá»i gian"]);
  }

  var order = JSON.parse(e.parameter.order);

  order.items.forEach(item => {
sheet.appendRow([
  order.phoneNumber,
  item.name,
  item.size || "",
  String(item.quantity), // ğŸ‘‰ Ã©p sá»‘ thÃ nh chuá»—i Ä‘á»ƒ khÃ´ng bá»‹ thÃ nh ngÃ y
  (item.toppings || []).map(t => t.name).join(", "),
  order.notes || "",
  item.price * item.quantity,
  new Date()
]);
  });

  return ContentService.createTextOutput("success");
}
/////////////////////////////////////////////////////////////////////////////////
function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Orders");
  if (!sheet) {
    sheet = SpreadsheetApp.getActiveSpreadsheet().insertSheet("Orders");
    sheet.appendRow(["SÄT","TÃªn mÃ³n","Size","SL","Topping","Ghi chÃº","Tá»•ng tiá»n","Thá»i gian"]);
  }

  var order = JSON.parse(e.parameter.order);

  order.items.forEach(item => {
sheet.appendRow([
  order.phoneNumber,
  item.name,
  item.size || "",
  String(item.quantity), // ğŸ‘‰ Ã©p sá»‘ thÃ nh chuá»—i Ä‘á»ƒ khÃ´ng bá»‹ thÃ nh ngÃ y
  (item.toppings || []).map(t => t.name).join(", "),
  order.notes || "",
  item.price * item.quantity,
  new Date()
]);
  });

  return ContentService.createTextOutput("success");
}

function deleteVisibleRowsFrom17() {
  var adminEmail = "nguyenminh.code.edu@gmail.com"; // Ä‘á»•i thÃ nh email admin tháº­t
  var userEmail = Session.getActiveUser().getEmail();

  if (userEmail !== adminEmail) {
    SpreadsheetApp.getUi().alert("âŒ Báº¡n khÃ´ng cÃ³ quyá»n xÃ³a dÃ²ng. Chá»‰ admin Ä‘Æ°á»£c phÃ©p.");
    return;
  }

  var sheet = SpreadsheetApp.getActiveSheet();
  var lastRow = sheet.getLastRow();

  // Náº¿u dÃ²ng 17 hiá»ƒn thá»‹ thÃ¬ xÃ³a tá»« 17 -> háº¿t
  if (!sheet.isRowHiddenByFilter(17) && !sheet.isRowHiddenByUser(17)) {
    var count = lastRow - 16;
    if (count > 0) {
      sheet.deleteRows(17, count);
    }
  }
}

// Menu khi má»Ÿ sheet
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu("ğŸ—‘ XÃ³a dÃ²ng (Admin)")
    .addItem("XÃ³a tá»« dÃ²ng 17 trá»Ÿ Ä‘i(Chá»‰ xÃ³a dÃ²ng Ä‘ang hiá»‡n-Nhá»› lá»c nhá»¯ng dÃ²ng cáº§n xÃ³a)", "deleteVisibleRowsFrom17")
    .addToUi();
}


